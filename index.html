<!DOCTYPE html>
<html>
<head>
<style>

</style>
<script>
    let maxLevel =   [4, 4, 4, 4, 4, 3, 3, 3, 1, 5, 5, 5, 2, 2, 3, 5, 1, 3, 3, 5, 2, 1, 1, 3, 3, 2, 1, 1, 1, 5, 3, 3, 1, 1, 4, 3, 3, 3, 3];
    let multiplier = [1, 1, 1, 2, 1, 4, 2, 2, 2, 1, 1, 1, 1, 2, 2, 1, 4, 1, 2, 1, 2, 2, 4, 2, 2, 2, 2, 4, 4, 2, 2, 1, 4, 2, 1, 1, 4, 4, 2];
    let names = ["Protection", "Fire Protection", "Feather Falling", "Blast Protection", "Projectile Protection", "Thorns",//
				"Respiration", "Depth Strider", "Aqua Affinity", "Sharpness", "Smite", "Bane of Arthropods", "Knockback", "Fire Aspect", "Looting",//
				"Efficiency", "Silk Touch", "Unbreaking", "Fortune", "Power", "Punch", "Flame", "Infinity", "Luck of the Sea", "Lure", "Frost Walker",//
				"Mending", "Curse of Binding", "Curse of Vanishing", "Impaling", "Riptide", "Loyalty", "Channeling", "Multishot", "Piercing", "Quick Charge",//
				"Soul Speed", "Swift Sneak", "Sweeping Edge"];
	let types = {
	    helmet:["Protection","Blast Protection", "Fire Protection", "Projectile Protection", "Aqua Affinity", "Respiration", "Thorns", "Mending", "Unbreaking"],
	    chestplate:["Protection","Blast Protection", "Fire Protection", "Projectile Protection", "Mending", "Thorns", "Unbreaking"],
	    leggings:["Protection","Blast Protection", "Fire Protection", "Projectile Protection", "Swift Sneak", "Thorns", "Mending", "Unbreaking"],
	    boots:["Protection","Blast Protection", "Fire Protection", "Projectile Protection", "Depth Strider", "Frost Walker", "Feather Falling", "Soul Speed", "Thorns", "Mending", "Unbreaking"],
	    sword:["Sharpness", "Smite", "Bane of Arthropods", "Fire Aspect", "Knockback", "Looting", "Sweeping Edge", "Mending", "Unbreaking"],
	    axe:["Sharpness", "Smite", "Bane of Arthropods", "Efficiency", "Fortune", "Silk Touch", "Mending", "Unbreaking"],
	    tool:["Efficiency", "Fortune", "Silk Touch", "Mending", "Unbreaking"],
	    trident:["Channeling", "Loyalty", "Riptide", "Impaling", "Mending", "Unbreaking"],
	    bow:["Flame", "Infinity", "Power", "Punch", "Mending", "Unbreaking"],
	    crossbow:["Multishot", "Piercing", "Quick Charge", "Mending", "Unbreaking"],
	    fishingrod:["Luck of the Sea", "Lure", "Mending", "Unbreaking"],
	    shears:["Efficiency", "Mending", "Unbreaking"],
	    other:["Mending", "Unbreaking"]
	};
	class Enchantment {
	    isItem;
	    useXp;
	    
	    name;
	    
	    cost;
	    tax;
	    weight;
	    
	    combineCost;
	    
	    constructor(name, cost) {
	    	this.name = name;
	    	
	    	this.cost = cost;
	    	this.tax = 0;
	    	this.weight = 0;

	    	this.combineCost = 0;
	    	this.useXp = false;
	    	this.isItem = false;
	    }
	    
	    static copy(ench) {
	    	let copied = new Enchantment(ench.name, ench.cost);
	    	copied.tax = ench.tax;
	    	copied.weight = ench.weight;
	    	copied.combineCost = ench.combineCost;
	    	copied.useXp = ench.useXp;
	    	copied.isItem = ench.isItem;
	    	return copied;
	    }
	    
	    static combine(a, b) {
	        let next = new Enchantment("(" + a.name + " + " + b.name + ")", a.cost + b.cost);
			next.tax = Math.max(a.tax, b.tax) * 2 + 1;
			next.combineCost = (b.cost + a.tax + b.tax);
			next.useXp = a.useXp || b.useXp;
			next.weight = (next.useXp ? levelsToXp(combineCost) : next.combineCost) + (a.weight + b.weight);

			next.isItem = a.isItem || b.isItem;
			return next;
	    }
	    
		static levelsToXp(level) {
			if (level < 17) {
				return level * level + 6 * level;
			}
			if (level < 32) {
				return Math.floor(2.5 * level * level - 40.5 * level + 360);
			}
			return Math.floor(4.5 * level * level - 162.5 * level + 2220);
		}
	}
	class ETree {
		multiplier;
		ench;
		left;
		right;
		
		constructor() {
			this.multiplier = -1;
			this.ench = null;
			this.left = null;
			this.right = null;
		}
		
		getCompleteEnchantment() {
			if (this.left != null) {
				e = Enchantment.combine(this.left.getCompleteEnchantment(), this.right.getCompleteEnchantment());
				return e;
			}
			return e;
		}
		
		getMultiplier() {
			if (this.multiplier != -1) {
				return this.multiplier;
			}
			this.getMultiplierRec(0);
			return this.multiplier;
		}

		getMultiplierRec(m) {
			this.multiplier = m;
			if (this.left != null) {
				this.right.getMultiplierRec(m + 1);
				this.left.getMultiplierRec(m);
			}
		}
		
		size() {
			let size = 1;
			if (this.left != null) {
				size += this.left.size();
				size += this.right.size();
			}
			return size;
		}

		depth() {
			let size = 1;
			if (this.left != null) {
				size += Math.max(this.left.depth(), this.right.depth());
			}
			return size;
		}
		
		invalidate() {
			this.multiplier = -1;
			this.e = null;
			if (this.left != null) {
				this.left.invalidate();
				this.right.invalidate();
			}
		}
		
		getNodes() {
			return this.getNodesRec([]);
        }
        
		getNodesRec(tree) {
			if (this.left != null) {
				this.left.getNodes(tree);
				this.right.getNodes(tree);
			}
			tree.push(this);
			return tree;
		}

		getLeaves() {
			return getLeavesRec([]);
        }

		getLeavesRec(tree) {
			if (this.left != null) {
				this.left.getLeaves(tree);
				this.right.getLeaves(tree);
			} else {
				this.tree.push(this);
			}
			return tree;
		}
	}
    function typeSelect() {
        let enchList = types[document.getElementById("type-select").value];
        let table = document.getElementById("enchantment-select");
        while (table.rows.length > 0) table.deleteRow(0);
        let max = 0;
        enchList.forEach(e => max = Math.max(maxLevel[names.indexOf(e)], max));
        let topBar = table.insertRow();
        topBar.insertCell("<td></td>");
        for (let i = 0; i <= max; i++) {
            let cell = topBar.insertCell();
            cell.innerText = i + "";
            cell.style = "text-align:center";
        }
        for (let index in enchList) {
        	let ench = enchList[index]
            let row = table.insertRow();
            row.insertCell().innerText = ench;
            for (let i = 0; i <= maxLevel[names.indexOf(ench)]; i++) {
                let cell = row.insertCell();
                let button = document.createElement("input");
                button.type = "radio";
                if (i===0) {
                    button.checked = true;
                }
                button.onchange = changeInput;
                button.name = ench;
                cell.append(button);
            }
        }
        document.getElementById("select-label").innerText = "Select enchantments:";
        changeInput();
        
    }
    function changeInput() {
        console.log("update");
        let steps = document.getElementById("steps");
        steps.innerHTML = "";
        let step = document.createElement("li")
        step.innerText = "Hello World"
        steps.appendChild(step)
        let ench = [];
        let table = document.getElementById("enchantment-select").children[0].children;
        for (let i = 1; i<table.length;i++) {
        	console.log(table[i].children[0].innerText);
        	let row = table[i].children;
        	let name = row.innerText;
        	let level = 0;
        	for (let j = 1; j<row.length;j++) {
        		if (row[j].children[0].checked == true) {
        			level = j - 1;
        		}
        	}
        	if (level != 0) {
        		ench.push(new Enchantment(name+" "+level, level*multiplier[names.indexOf(name)]));
        	}
        }
        console.log(ench);

        
    }
</script>
</head>
<body>

<h1>Minecraft Optimal Enchantment Combination</h1>

<select name="item-type" id="type-select" onchange="typeSelect()">
    <option value="type">Select item type</option>
    
    <option value="helmet">Helmet</option>
    <option value="chestplate">Chestplate</option>
    <option value="leggings">Leggings</option>
    <option value="boots">Boots</option>
    <option value="sword">Sword</option>
    <option value="axe">Axe</option>
    <option value="tool">Tool</option>
    <option value="trident">Trident</option>
    <option value="bow">Bow</option>
    <option value="crossbow">Crossbow</option>
    <option value="fishingrod">Fishing Rod</option>
    <option value="shears">Shears</option>

    <option value="other">Other</option>
</select>

<p id="select-label"></p>

<table id="enchantment-select">
</table>
<ol id="steps">
</ol>
</body>
</html>
